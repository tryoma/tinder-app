Ruby on Rails ã‚’ä½¿ã£ãŸå®Ÿè·µçš„ãªé–‹ç™ºæ–¹æ³•ã‚’å­¦ã³ã¾ã™
Devise ã‚’ä½¿ã£ãŸèªè¨¼æ©Ÿèƒ½ã®é–‹ç™ºã‚’è¡Œã„ã¾ã™
ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®é–‹ç™ºã‚’è¡Œã„ã¾ã™
seed ã‚’ä½¿ã£ãŸåˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥æ–¹æ³•ã‚’å­¦ã³ã¾ã™
Hammer.js ã‚’ä½¿ã£ã¦ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ã®é–‹ç™ºã‚’è¡Œã„ã¾ã™
ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ–¹æ³•ã‚’å­¦ã³ã¾ã™
Action Cable ã‚’ä½¿ã£ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹æ©Ÿèƒ½ã®é–‹ç™ºã‚’è¡Œã„ã¾ã™

settings.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼ˆå†…å®¹ã‚’ç†è§£ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚

json
{
    // å·®åˆ†ã‚’æ¨ªã«ä¸¦ã¹ã¦è¡¨ç¤ºã›ãšã«ã€è¡Œå†…ã«è¡¨ç¤ºã™ã‚‹
    "diffEditor.renderSideBySide": false,
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹
    "editor.formatOnSave": true,
    // ç¾åœ¨ã®è¡Œã‚’å¼·èª¿è¡¨ç¤ºã™ã‚‹
    "editor.renderLineHighlight": "all",
    // ç©ºç™½æ–‡å­—ã‚’è¡¨ç¤ºã™ã‚‹
    "editor.renderWhitespace": "all",
    // ã‚¹ãƒšãƒ¼ã‚¹2å€‹åˆ†ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ
    "editor.tabSize": 2,
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…å³ç«¯ã§æŠ˜ã‚Šè¿”ã™
    "editor.wordWrap": "on",
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ã«æ–°ã—ã„è¡Œã‚’æœ«å°¾ã«æŒ¿å…¥ã™ã‚‹
    "files.insertFinalNewline": true,
    // ã‚¢ã‚¤ã‚³ãƒ³ãƒ†ãƒ¼ãƒã®æŒ‡å®š
    "workbench.iconTheme": "vscode-icons"
}
ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ãŸã‚‰ã€settings.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
ï¼ˆcommand + Sã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ä¸Šæ›¸ãä¿å­˜ãŒã§ãã¾ã™ï¼‰

â— Ruby
  â†’ VSCodeã«å¯¾ã™ã‚‹Rubyè¨€èªã¨ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã™ã‚‹ã€‚

â— Japanese Language Pack for Visual Studio Code
  â†’ æ—¥æœ¬èªå¯¾å¿œã®VSCodeã®UIã‚’æä¾›ã™ã‚‹ã€‚

â— vscode-icons
  â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã€‚
ãã‚Œã§ã¯æ‹¡å¼µæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

â—Homebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å°å…¥ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã€macOSç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹Homebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
brew -v

Homebrew 2.5.8
Homebrew/homebrew-core (git revision 8ef7f; last commit 2020-11-05)
Homebrew/homebrew-cask (git revision 0e83ed; last commit 2020-11-05)
ã€ŒHomebrew 2.5.8ã€ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã€HomebrewãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

â—rbenvã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«ã€Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç°¡å˜ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹rbenvã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

brew install rbenv
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œå¾Œã«ã€å®Ÿéš›ã«rbenvãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

rbenv --version
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

rbenv --version
rbenv 1.1.2
ã“ã®è¡¨ç¤ºã§ã¯ã€Œrbenv 1.1.2ã€ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

rbenvãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚

â—rbenvã«PATHã‚’é€šã™
rbenvã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€rbenvã«PATHã‚’é€šã—ã¾ã™ã€‚

ã€ŒPATHã‚’é€šã™ã€ã¨ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ã™ã€‚

å‚è€ƒï¼šPATHã‚’é€šã™ã¨ã¯ï¼Ÿï¼ˆMac OS Xï¼‰

rbenvã‚³ãƒãƒ³ãƒ‰ã®PATHã‚’é€šã™ãŸã‚ã«ã€æ¬¡ã®3ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

console
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bash_profile
echo 'if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi' >> ~/.bash_profile
source ~/.bash_profile
ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ï¼‘è¡Œãšã¤å…¥åŠ›ã—ã¦ã€å®Ÿè¡Œã—ã¾ã™ã€‚

ã¾ãšã¯æœ€åˆã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’.bash_profileã«è¿½åŠ ã—ã¾ã™ã€‚

console
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bash_profile
>> ~/.bash_profileã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’.bash_profileã«è¿½åŠ ã—ã¾ã—ãŸã€‚

æ¬¡ã«ã€ï¼’ç•ªã‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

console
echo 'if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi' >> ~/.bash_profile
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«èµ·å‹•æ™‚ã«rbenvã‚’è‡ªå‹•çš„ã«èµ·å‹•ã•ã›ã¾ã™ã€‚

æœ€å¾Œã«ã€sourceã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦è¿½åŠ ã—ãŸå†…å®¹ã‚’åæ˜ ã—ã¾ã™ã€‚

console
source ~/.bash_profile
.bash_profileã«è¿½åŠ ã—ãŸå†…å®¹ã‚’åæ˜ ã§ãã¾ã—ãŸã€‚

ã“ã‚Œã§rbenvã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã®ã«å¿…è¦ãªPATHãŒé€šã‚Šã¾ã—ãŸã€‚

â—Rubyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«Rubyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

Rubyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å‰ã«ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¾ã™ã€‚

rbenv install -l
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æœ€æ–°ã®å®‰å®šç‰ˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸€è¦§ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã‚‚ã—æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€rbenvã¨rubyâ€‹â€‹-buildã‚’æœ€æ–°ç‰ˆã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å‚è€ƒï¼šrbenv Upgrading with Homebrew

ãã‚Œã§ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦Ruby 2.7.2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

console
rbenv install 2.7.2
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é–‹å§‹ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã¾ã§æ•°åˆ†é–“ã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã§RubyãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½¿ã†Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
ã•ã‚‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½¿ã†Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

console
rbenv local 2.7.2
ã“ã‚Œã§ãƒ­ãƒ¼ã‚«ãƒ«ã§Rubyã®2.7.1ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«localã‚’ä½¿ã†ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

PCï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰å†…ã§åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…±é€šã—ã¦ä½¿ã†å ´åˆã¯ã€localã§ã¯ãªãglobalã‚’ä½¿ã„ã¾ã™ã€‚

æ¬¡ã«ã€Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’ç¢ºèªã—ã¾ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
ruby -v
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

â—Bundlerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Rubyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ã€æ¬¡ã«Bundlerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

Rubyã§ã¯Gemã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

Gemã‚³ãƒãƒ³ãƒ‰ã§ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã™ãŒã€è¤‡æ•°ã®Gemã‚’ä½¿ã†ã¨GemåŒå£«ã§ä¾å­˜é–¢ä¿‚ãŒç”Ÿã¾ã‚Œã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ã«ã‚ˆã‚‹ä¸å…·åˆãŒå‡ºã¦ãã¾ã™ã€‚

ãã“ã§ã€Bundlerã§Gemã®ãã‚Œãã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ­£ç¢ºã«è¿½è·¡ã—ç®¡ç†ã—ã¦ã€Rubyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä¸€è²«ã—ãŸç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚

console
bundler -v
ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå¾Œã€æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
bundler -v
Bundler version 2.1.4
ã€Œversion 2.1.4ã€ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã§BlundlerãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚

â—yarnã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«yarnã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

yarnã¯JavaScriptã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ©ç”¨ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã§ã™ã€‚

yarnã¨äº’æ›æ€§ã®ã‚ã‚‹npmã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚‚ã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€Rails6ã§ã¯WebpackerãŒæ¨™æº–ã«ãªã£ãŸã“ã¨ã«ã‚ˆã‚Šã€yarnãŒå¿…è¦ã§ã™ã€‚

ãã‚Œã§ã¯ã€yarnã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
brew install yarn
Homebrewã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€yarnãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

yarnãŒå®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

yarn -v
1.16.0
ã“ã“ã§ã¯ã€Œ1.16.0ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€yarnãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

â—Railsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã„ã‚ˆã„ã‚ˆã€Railsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

Railsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã€Œ-v ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã€ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

ä»Šå›ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€Œ6.0.3.4ã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

å‚è€ƒï¼šrailsã®å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
gem install rails -v 6.0.3.4
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é–‹å§‹ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å®Œäº†ã¾ã§ã«æ•°åˆ†ã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

Railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª
Railsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ã€Railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
rails -v
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
rails -v
Rails 6.0.3.4
ã€ŒRails 6.0.3.4ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã§ç„¡äº‹ã«Ruby on Railsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

â—PostgreSQLã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
æœ¬æ•™æã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯PostgreSQLã§ã™ã€‚

â€» SQLite3ã§ã‚‚å­¦ç¿’ã‚’é€²ã‚ã‚‰ã‚Œã¾ã™

PostgreSQLã¯ç„¡å„Ÿã§åˆ©ç”¨ã§ãã‚‹ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚Homebrewã‚’ä½¿ã£ã¦ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
brew install postgresql
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

å®Ÿéš›ã«PostgreSQLãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
psql --version
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
psql --version
psql (PostgreSQL) 11.2
ã€Œpsql (PostgreSQL) 11.2ã€ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚ŒãŸã®ã§ã€PostgreSQLã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ã€PostgreSQLã‚’èµ·å‹•ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
brew services start postgresql
PostgreSQLã‚’èµ·å‹•ã•ã›ã‚‹ç†ç”±ã¨ã—ã¦ã¯ã€Railsã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ãŸéš›ã«PostgreSQLãŒèµ·å‹•ã—ã¦ã„ãªã‹ã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŸã‚ã§ã™ã€‚

ä»Šå›ã®ç›®æ¨™ã¯ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ã€Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€ã“ã¨ã§ã™ã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸRailsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª
æ–°è¦Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
ä½œæˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
ãã‚Œã§ã¯ã€å®Ÿéš›ã«Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚

1. ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹Railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç¢ºèª
æ–°è¦Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸRailsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¾ã™ã€‚

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

console
gem search ^rails$ -l
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
gem search ^rails$ -l

*** LOCAL GEMS ***

rails (6.0.3.4)
ã€ŒRails6.0.3.4ã€ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

è¡¨ç¤ºã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã€Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

2. æ–°è¦Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
Railsã§Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ–°è¦ä½œæˆã—ã¾ã™ã€‚

Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–°è¦ä½œæˆã§ã¯ã€rails newã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

rails newã‚³ãƒãƒ³ãƒ‰ã§ã¯å‘½ä»¤æ–‡ã®æœ€å¾Œã«ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’æŒ‡å®šã—ã¾ã™ã€‚

ã€ä¾‹ã€‘

console
rails new ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å
ä»Šå›ã¯Rails6.0.3.4ã‚’ä½¿ã£ã¦ã€Œtechpit-matchã€ã¨ã„ã†åå‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
rails _6.0.3.4_ new techpit-match --database=postgresql
å‘½ä»¤æ–‡ã®railsã¨newã®é–“ã«Railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€Railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã§ãã¾ã™ï¼ˆã“ã“ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚ã‚‹6.0.3.4ã‚’æŒ‡å®šï¼‰ã€‚

ã¾ãŸ--database=ã§åˆ©ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŒ‡å®šã§ãã¾ã™ï¼ˆã“ã“ã§ã¯postgresqlã‚’æŒ‡å®šï¼‰ã€‚

rails newã‚³ãƒãƒ³ãƒ‰ã§ã€Œtechpit-matchã€ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ•ã‚©ãƒ«ãƒ€ï¼‰ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚

3. ä½œæˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cdã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€æ–°ãŸã«ä½œæˆã—ãŸã€Œtechpit-matchã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚

ã¡ãªã¿ã«ã€Œcdã€ã¯ã€change directoryï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç§»å‹•ã™ã‚‹ï¼‰ã®ç•¥ã§ã™ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»å‹•ã‚’è¡Œã†å‘½ä»¤æ–‡ã¯ã€æ¬¡ã®è¡¨ç¾ã«ãªã‚Šã¾ã™ã€‚

ã€ä¾‹ã€‘

console
cd ç§»å‹•ã—ãŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå
ä»Šå›ã¯ã€Œtechpit-matchã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã™ã‚‹ãŸã‚ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
cd techpit-match
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã€Œtechpit-matchã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚

4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
ã€Œtechpit-matchã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ãŸã‚ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
rails db:create
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
rails db:create
Created database 'techpit_match_development'
Created database 'techpit_match_test'
rails db:create ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€config/database.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

config/database.ymlãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã™ã‚‹è¨­å®šãŒè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚å®Ÿéš›ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

config/database.yml
# ä¸­ç•¥
# Configure Using Gemfile
# gem 'pg'
#
default: &default
  adapter: postgresql
  encoding: unicode
  # For details on connection pooling, see Rails configuration guide
  # https://guides.rubyonrails.org/configuring.html#database-pooling
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>

development:
  <<: *default
  database: techpit_match_development

  # ä¸­ç•¥

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
  <<: *default
  database: techpit_match_test

# As with config/credentials.yml, you never want to store sensitive information,
# like your database password, in your source code. If your source code is
# ever seen by anyone, they now have access to your database.
# ä¸­ç•¥
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ãã ã•ã„ã€‚

config/database.yml
development:
  <<: *default
  database: techpit_match_development

  # ä¸­ç•¥

test:
  <<: *default
  database: techpit_match_test
developmentã¯é–‹ç™ºç”¨ã¨ã„ã†æ„å‘³ã§ã€testã¯ãƒ†ã‚¹ãƒˆç”¨ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚

databaseã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ä»Šå›ã§ã„ã†ã¨é–‹ç™ºç”¨ã¯techpit_match_developmentã€ãƒ†ã‚¹ãƒˆç”¨ã¯techpit_match_testã¨ã„ã†åå‰ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

5. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

console
rails server
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¾ã™ï¼ˆrails sã¨çœç•¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼‰ã€‚

ã†ã¾ãã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã™ã‚‹ã¨ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
rails server
=> Booting Puma
=> Rails 6.0.3.2 application starting in development 
=> Run `rails server --help` for more startup options
Puma starting in single mode...
* Version 4.3.5 (ruby 2.7.1-p83), codename: Mysterious Traveller
* Min threads: 5, max threads: 5
* Environment: development
* Listening on tcp://127.0.0.1:3000
* Listening on tcp://[::1]:3000
Use Ctrl-C to stop
6. Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ãŸã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã€Œhttp://localhost:3000/ ã€ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

æ¬¡ã®ç”»åƒã®ã‚ˆã†ã«Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ã†ã¾ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

image

ä»¥ä¸Šã§ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚

æœ¬æ•™æã§ä½¿ã†ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰3ã¤ã®ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

https://drive.google.com/drive/folders/1-FomnekKzTbaxCjGdYA6qtOR0vZZk2qg?usp=sharing

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€app/javascript/imagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ç”»åƒã‚’ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚ç”»åƒã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§ç§»å‹•ã§ãã¾ã™ã€‚

â€» app/javascriptãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« imagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãªã„ãŸã‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ç”»åƒã‚’ç§»å‹•ã—ã¦ãã ã•ã„

console
mkdir app/javascript/images
javascript/images/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ãªã‚Œã°OKã§ã™ã€‚

image

æœ€å¾Œã«ã€app/javascript/imagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ç”»åƒã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

â—config/webpacker.yml ã‚’æ¬¡ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

config/webpacker.yml
# ä¸­ç•¥

  webpack_compile_output: true

  # Additional paths webpack should lookup modules
  # ['app/assets', 'engine/foo/app/assets']
  resolved_paths: []
  resolved_paths: ['app/javascript/images', 'app/assets/images']

  # Reload manifest.json on all requests so we reload latest compiled packs
  cache_manifest: false

  # Extract and emit a css file
  extract_css: false

# ä¸­ç•¥

â—ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã§ã¯Bootstrapã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚
Bootstrapã¯æœ‰åãªWebãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€CSSã‚’ç´°ã‹ãæŒ‡å®šã›ãšã«ã‚µã‚¤ãƒˆã‚’ã‚ã‚‹ç¨‹åº¦å½¢ã«ã§ãã¾ã™ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã«ã‚‚å¯¾å¿œã—ã¦ãã‚Œã‚‹ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Bootstrapã‚’å°å…¥ã™ã‚‹ã¨Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åŠ¹ç‡ã‚ˆãé–‹ç™ºã§ãã¾ã™ã€‚

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
Webpackerã¨ã¯
Bootstrapã‚’Webpackerã§å°å…¥
BootstrapãŒå°å…¥ã•ã‚ŒãŸã‹ç¢ºèª
ãã‚Œã§ã¯ã€Bootstrapã®å°å…¥ã‚’ãŠã“ãªã„ã¾ã—ã‚‡ã†ã€‚

1. Webpackerã¨ã¯
ä»Šå›Bootstrapã‚’å°å…¥ã™ã‚‹ã«ã‚ãŸã£ã¦ã€Webpackerã‚’ä½¿ã£ã¦å°å…¥ã—ã¦ã„ãã¾ã™ã€‚

Webpackerã¨ã¯ã€è¤‡æ•°ã®JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’1ã¤ã«ã¾ã¨ã‚ã¦å‡ºåŠ›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹webpackã‚’ç°¡å˜ã«Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ±åˆã§ãã‚‹gemã§ã™ã€‚

Rails5.1ã‹ã‚‰æ¨™æº–ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

webpackã¨ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ„ãƒ¼ãƒ«ã®ã“ã¨ã§ã€æ˜¨ä»Šã®ãƒ¢ãƒ€ãƒ³ãªJavaScripté–‹ç™ºã§å¿…é ˆã¨ãªã‚Šã¤ã¤ã‚ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

ä»¥ä¸‹ã®ç”»åƒã¯webpackã®å…¬å¼ã‚µã‚¤ãƒˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸å›³ã«ãªã‚Šã¾ã™ã€‚

2. Bootstrapã‚’Webpackerã§å°å…¥
Webpackerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€ã¾ãšGemfileã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãŸã å…ˆã»ã©èª¬æ˜ã—ãŸé€šã‚Šã€Rails5.1ä»¥é™æ¨™æº–ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§GemãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¸€å¿œGemfileã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

techpit-match
â””â”€â”€ Gemfile
gem 'webpacker', '~> 4.0'
ãªã®ã§gemã¯è¿½åŠ ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Gemfileã«webpackerã¨ã„ã†gemãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã‚‰Bootstrapã‚’å°å…¥ã—ã¾ã™ã€‚

yarn ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€yarn addã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ã€ä¾‹ã€‘

console
yarn add project-name
å‚è€ƒï¼šyarn add

ãã‚Œã§ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
yarn add jquery bootstrap popper.js
Bootstrapã§ã¯ã€ã„ãã¤ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ jQuery, Popper.js ã¨ã„ã£ãŸ JavaScript ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªãŸã‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã†ã¾ãã„ã£ã¦ã„ãŸã‚‰ã€package.json ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚è¿½åŠ ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ã¯å°å…¥ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ¬¡ã«å°å…¥ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¨­å®šã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚config/webpack/environment.jsã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

config/webpack/environment.js
const { environment } = require('@rails/webpacker')

module.exports = environment

# ==========ã“ã“ã‹ã‚‰è¿½åŠ ã™ã‚‹==========
const webpack = require('webpack')
environment.plugins.append(
  'Provide',
  new webpack.ProvidePlugin({
    $: 'jquery/src/jquery',
    jQuery: 'jquery/src/jquery',
    Popper: ['popper.js', 'default']
  })
)
# ==========ã“ã“ã¾ã§è¿½åŠ ã™ã‚‹==========
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§importã‚„requireãªã—ã§$ã‚„Bootstrapã®JavaScriptãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Bootstrapã®styleã‚’import
æ¬¡ã«ã€app/javascript/stylesheets/application.scssã«Bootstrapã®styleã‚’importã™ã‚‹è¨˜è¿°ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

ã“ã®app/javascript/stylesheetsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŠã³ã€app/javascript/stylesheets/application.scssãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ã—ãªã„ã®ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã—ã¾ã™ã€‚

console
mkdir app/javascript/stylesheets
touch app/javascript/stylesheets/application.scss
ä½œæˆã—ãŸã‚‰ã€application.scssãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/javascript/stylesheets/application.scss
@import '~bootstrap/scss/bootstrap';
application.jsã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
yarnã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸBootstrapã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«importã—ã¾ã™ã€‚

app/javascript/packs/application.js ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/javascript/packs/application.js
# ==========ã“ã“ã‹ã‚‰è¿½åŠ ã™ã‚‹==========
import 'bootstrap';
import '../stylesheets/application';
# ==========ã“ã“ã¾ã§è¿½åŠ ã™ã‚‹==========

// This file is automatically compiled by Webpack, along with any other files
// present in this directory. You're encouraged to place your actual application logic in
// a relevant structure within app/javascript and only use these pack files to reference
// that code so it'll be compiled.

require("@rails/ujs").start()
require("turbolinks").start()
require("@rails/activestorage").start()
require("channels")


// Uncomment to copy all static images under ../images to the output folder and reference
// them with the image_pack_tag helper in views (e.g <%= image_pack_tag 'rails.png' %>)
// or the `imagePath` JavaScript helper below.
//
// const images = require.context('../images', true)
// const imagePath = (name) => images(name, true)
ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã« stylesheet_pack_tag ã‚’è¿½åŠ 
æœ€å¾Œã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«stylesheet_pack_tagã‚’è¿½åŠ ã—ã¾ã™ã€‚stylesheet_pack_tagã‚’ä½¿ã†ã“ã¨ã§Webpackã§.cssã‚„.scssãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã«ã‚‚å¯¾å¿œã—ã¾ã™ã€‚

app/views/layouts/application.html.erbã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/views/layouts/application.html.erb
<!DOCTYPE html>
<html>
  <head>
    <title>TechpitMatch</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <%# ã“ã“ã«è¿½åŠ  %>
    <%= stylesheet_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

  </head>

  <body>
    <%= yield %>
  </body>
</html>
ä»¥ä¸Šã§Bootstrapã®å°å…¥ã¯çµ‚äº†ã§ã™ã€‚

3. BootstrapãŒå°å…¥ã•ã‚ŒãŸã‹ç¢ºèª
å®Ÿéš›ã«BootstrapãŒæ©Ÿèƒ½ã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

ä»®ã®ãƒœã‚¿ãƒ³ã«Bootstrapã®ã‚¯ãƒ©ã‚¹ã‚’å½“ã¦ã¾ã™ã€‚

app/views/top/index.html.erbã‚’ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/views/top/index.html.erb
<p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>

<%# ã“ã“ã«è¿½åŠ  %>
<%= link_to "ä»®ã®ãƒœã‚¿ãƒ³ã§ã™", "#", class: "btn btn-primary" %>
ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰ã€http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚é’è‰²ã®ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã†ã¾ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

image

ä»¥ä¸Šã§ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚
  
4-2
Deviseã®å°å…¥
4ç« ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æ©Ÿèƒ½ã‚’ç°¡å˜ã«å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€Deviseã¨ã„ã†gemã‚’å°å…¥ã—ã¾ã™ã€‚

Deviseã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚„ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãªã©ã®èªè¨¼ã«å¿…è¦ãªæ©Ÿèƒ½ã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹Railsç”¨ã®gemã§ã™ã€‚

Deviseã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰ã§ã™ã€‚

å‚è€ƒ: Devise

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€ä¸‹è¨˜ã®ç”»åƒã®ã‚ˆã†ã«ãƒ‡ã‚¶ã‚¤ãƒ³ã¯ä½•ã‚‚ãªã„çŠ¶æ…‹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã™ã€‚

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒšãƒ¼ã‚¸

ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
Deviseã®gemã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Deviseã®ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Userãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
Usersãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
Deviseã®å°å…¥ã®ç¢ºèª
Devise ã®å°å…¥ã¯ã€åŸºæœ¬çš„ã«å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ²¿ã£ã¦å®Ÿè£…ã—ã¦ã„ãã®ã§ã€å°å…¥æ–¹æ³•ã‚’è¦šãˆã‚‹å¿…è¦ã¯ãªã„ã§ã™ã€‚

ã§ã¯ã€å®Ÿéš›ã«é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. Deviseã®gemã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã¾ãšä»Šå›å°å…¥ã™ã‚‹Deviseã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰Devise

ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰ã€ŒGetting startedã€ã®ç®‡æ‰€ã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚

image

ã€ŒAdd the following line to your Gemfileã€ã¨ã‚ã‚‹ã®ã§ã€ã¾ãšGemfileã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

techpit-match
â””â”€â”€ Gemfile
gem 'devise'
Gemfileã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ã£ãŸã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã¯ä¸è¦ãªã®ã§å‰Šé™¤ã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

ä¸Šè¨˜ã®gemã‚’è¿½åŠ ã™ã‚‹ã¨Gemfileã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

source 'https://rubygems.org'
git_source(:github) { |repo| "https://github.com/#{repo}.git" }

ruby '2.7.2'

gem 'rails', '~> 6.0.3', '>= 6.0.3.4'
gem 'pg', '>= 0.18', '< 2.0'
gem 'puma', '~> 4.1'
gem 'sass-rails', '>= 6'
gem 'webpacker', '~> 4.0'
gem 'turbolinks', '~> 5'
gem 'jbuilder', '~> 2.7'
gem 'bootsnap', '>= 1.4.2', require: false

# ã“ã“ã«è¿½åŠ 
gem 'devise'

group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
end

group :development do
  gem 'web-console', '>= 3.3.0'
  gem 'listen', '~> 3.2'
  gem 'spring'
  gem 'spring-watcher-listen', '~> 2.0.0'
end

group :test do
  gem 'capybara', '>= 2.15'
  gem 'selenium-webdriver'
  gem 'webdrivers'
end

gem 'tzinfo-data', platforms: [:mingw, :mswin, :x64_mingw, :jruby]
è¿½åŠ ã—ãŸgemã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«bundle installã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

console
bundle install
æ¬¡ã«ã€ŒNext, you need to run the generatorã€ã¨å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹ã‚ˆã†ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
rails generate devise:install
ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

create  config/initializers/devise.rb
create  config/locales/devise.en.yml
ã¾ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã¡ã‚‰ã¯Deviseã‚’ä½¿ã†ä¸Šã§ã®åˆæœŸè¨­å®šã«ãªã‚‹ã®ã§ã€1ã‹ã‚‰é †ã«è¦‹ã¦è¡Œãã¾ã—ã‚‡ã†ã€‚

console
rails generate devise:install
Running via Spring preloader in process 16776
      create  config/initializers/devise.rb
      create  config/locales/devise.en.yml
===============================================================================

Depending on your application's configuration some manual setup may be required:

  1. Ensure you have defined default url options in your environments files. Here
     is an example of default_url_options appropriate for a development environment
     in config/environments/development.rb:

       config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }

     In production, :host should be set to the actual host of your application.

     * Required for all applications. *

  2. Ensure you have defined root_url to *something* in your config/routes.rb.
     For example:

       root to: "home#index"
     
     * Not required for API-only Applications *

  3. Ensure you have flash messages in app/views/layouts/application.html.erb.
     For example:

       <p class="notice"><%= notice %></p>
       <p class="alert"><%= alert %></p>

     * Not required for API-only Applications *

  4. You can copy Devise views (for customization) to your app by running:

       rails g devise:views
       
     * Not required *

===============================================================================
1ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®è¨­å®šã§æœ¬æ•™æã§ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®å®Ÿè£…ã¯è¡Œã‚ãªã„ã®ã§ã€1ã¯é£›ã°ã—ã¾ã™ã€‚

2ã‚‚æ—¢ã«rootãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’3ç« ã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€2ã‚‚é£›ã°ã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

3ã¯ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«é–¢ã—ã¦ã§ã™ãŒã€æœ¬æ•™æã§ã¯ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å®Ÿè£…ã—ãªã„ã®ã§ã€3ã‚‚é£›ã°ã—ã¾ã™ã€‚

æœ¬æ•™æã§ã¯ã€4ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

2. Deviseã®ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
å…ˆã»ã©ã®4ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚

4. You can copy Devise views (for customization) to your app by running:

       rails g devise:views
ç›´è¨³ã™ã‚‹ã¨ã€ã€Œæ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Deviseã®ãƒ“ãƒ¥ãƒ¼ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚³ãƒ”ãƒ¼ã§ãã¾ã™ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚ãªã®ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Deviseã®ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

rails g devise:views
å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

rails g devise:views
Running via Spring preloader in process 17438
      invoke  Devise::Generators::SharedViewsGenerator
      create    app/views/devise/shared
      create    app/views/devise/shared/_error_messages.html.erb
      create    app/views/devise/shared/_links.html.erb
      invoke  form_for
      create    app/views/devise/confirmations
      create    app/views/devise/confirmations/new.html.erb
      create    app/views/devise/passwords
      create    app/views/devise/passwords/edit.html.erb
      create    app/views/devise/passwords/new.html.erb
      create    app/views/devise/registrations
      create    app/views/devise/registrations/edit.html.erb
      create    app/views/devise/registrations/new.html.erb
      create    app/views/devise/sessions
      create    app/views/devise/sessions/new.html.erb
      create    app/views/devise/unlocks
      create    app/views/devise/unlocks/new.html.erb
      invoke  erb
      create    app/views/devise/mailer
      create    app/views/devise/mailer/confirmation_instructions.html.erb
      create    app/views/devise/mailer/email_changed.html.erb
      create    app/views/devise/mailer/password_change.html.erb
      create    app/views/devise/mailer/reset_password_instructions.html.erb
      create    app/views/devise/mailer/unlock_instructions.html.erb
å®Ÿè¡Œçµæœã‹ã‚‰ã€æ§˜ã€…ãªhtml.erbãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

3. Userãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
ãƒ¢ãƒ‡ãƒ«ã¨ã¯MVCã§è¨€ã†ã¨ã“ã‚ã®Mã«ã‚ãŸã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã¯ã˜ã‚ã€æƒ…å ±ã®ã‚„ã‚Šå–ã‚Šã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã®éšå±¤ã§ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§Deviseç”¨ã®Userãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ¢ãƒ‡ãƒ«åã®å€¤ã¯ä»»æ„ã§ã™ã€‚ä½œæˆã—ãŸã„ãƒ¢ãƒ‡ãƒ«åã§ä½œæˆã§ãã¾ã™ã€‚ä»Šå›ã¯Userã¨ã„ã†ãƒ¢ãƒ‡ãƒ«åã§ä½œæˆã—ã¾ã™ã€‚

console
rails g devise User
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
rails g devise User
Running via Spring preloader in process 18101
      invoke  active_record
      create    db/migrate/20201117072443_devise_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/models/user_test.rb
      create      test/fixtures/users.yml
      insert    app/models/user.rb
       route  devise_for :users
æœ€å¾Œã®è¡Œã«route devise_for :usersã¨ã„ã†è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯config/routes.rbã«Deviseã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

å®Ÿéš›ã«config/routes.rbã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

config/routes.rb
Rails.application.routes.draw do
  devise_for :users
  root 'top#index'
end
devise_for :usersã¨ã„ã†è¨˜è¿°ãŒDeviseã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ãªã‚Šã¾ã™ã€‚ã“ã®1è¡Œã®ã‚³ãƒ¼ãƒ‰ãŒã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã‚„ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãªã©ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

4. Usersãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
å…ˆã»ã©Userãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ãŸéš›ã«ã€db/migrate/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚

image

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­è¨ˆå›³ã§ã™ã€‚è¨­è¨ˆå›³ã®ã¾ã¾ã ã¨ç‰¹ã«ä½•ã‹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯ãªã„ã®ã§ã€è¨­è¨ˆå›³ã‚’ã‚‚ã¨ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Railsã ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€è¨­è¨ˆå›³ã‚’å…ƒã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ãŸã‚Šã€ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ãŸã‚Šã§ãã¾ã™ã€‚

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

console
rails db:migrate
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
rails db:migrate
== 20201117072443 DeviseCreateUsers: migrating ================================
-- create_table(:users)
   -> 0.0159s
-- add_index(:users, :email, {:unique=>true})
   -> 0.0107s
-- add_index(:users, :reset_password_token, {:unique=>true})
   -> 0.0031s
== 20201117072443 DeviseCreateUsers: migrated (0.0299s) =======================
5. Deviseã®å°å…¥ã®ç¢ºèª
gemã‚’æ–°ã—ãè¿½åŠ ã—ã¦ã„ã‚‹ã®ã§ã€ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã•ã›ã¾ã™ã€‚ã¾ãšä»¥å‰ç«‹ã¡ä¸Šã’ã¦ã„ãŸã‚µãƒ¼ãƒãƒ¼ã‚’çµ‚äº†ã•ã›ã¾ã™ã€‚çµ‚äº†ã•ã›ã‚‹ã«ã¯control + Cã‚’åŒæ™‚ã«æŠ¼ã›ã°å¤§ä¸ˆå¤«ã§ã™ã€‚

ãã®å¾Œã€Œrails sã€ã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚

ãã—ã¦ã€http://localhost:3000/users/sign_up ã‚’é–‹ãã¨ä»¥ä¸‹ã®ç”»é¢ã®ã‚ˆã†ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚


ã¾ãŸ http://localhost:3000/users/sign_in ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚


ä»¥ä¸Šã§æœ¬ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
         
5-5
Font Awesome ã®å°å…¥
ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã§ã¯Font Awesomeã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚

Font Awesomeã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€Webä¸Šã§ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚©ãƒ³ãƒˆã¨ã„ã†æ–‡å­—ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚

image

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
Font Awesome ã®å°å…¥
Font Awesome ãŒå°å…¥ã•ã‚ŒãŸã‹ç¢ºèª
ã§ã¯ã€å®Ÿéš›ã«é€²ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1. Font Awesome ã®å°å…¥
ãã‚Œã§ã¯ã€Font Awesome ã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚Bootstrapã¨åŒæ§˜yarnã‚’ä½¿ã£ã¦å°å…¥ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
yarn add @fortawesome/fontawesome-free
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
yarn add @fortawesome/fontawesome-free
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
warning " > webpack-dev-server@3.11.0" has unmet peer dependency "webpack@^4.0.0 || ^5.0.0".
warning "webpack-dev-server > webpack-dev-middleware@3.7.2" has unmet peer dependency "webpack@^4.0.0".
[4/4] ğŸ”¨  Building fresh packages...
success Saved lockfile.
success Saved 1 new dependency.
info Direct dependencies
â””â”€ @fortawesome/fontawesome-free@5.15.1
info All dependencies
â””â”€ @fortawesome/fontawesome-free@5.15.1
âœ¨  Done in 4.33s.
package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

package.json
{
  "name": "techpit_match",
  "private": true,
  "dependencies": {
    "@fortawesome/fontawesome-free": "^5.15.1",
    "@rails/actioncable": "^6.0.0",
    "@rails/activestorage": "^6.0.0",
    "@rails/ujs": "^6.0.0",
æ¬¡ã«ã€app/javascript/stylesheets/application.scssã«Font Awesome ã®CSSã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

app/javascript/stylesheets/application.scss
@import '~bootstrap/scss/bootstrap';

/* ã“ã“ã«è¿½åŠ  */
@import '~@fortawesome/fontawesome-free/scss/fontawesome';

@import "top";

@import "users/sign_up";
@import "users/sign_in";
æ¬¡ã«yarnã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ Font Awesome ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«importã—ã¾ã™ã€‚

app/javascript/packs/application.jsã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/javascript/packs/application.js
import 'bootstrap';
import '../stylesheets/application';
// ã“ã“ã«è¿½åŠ 
import '@fortawesome/fontawesome-free/js/all';

// ä¸­ç•¥
ä»¥ä¸Šã§Font Awesomeã®å°å…¥ã¯çµ‚äº†ã§ã™ã€‚

2. Font Awesome ãŒå°å…¥ã•ã‚ŒãŸã‹ç¢ºèª
Font AwesomeãŒæ©Ÿèƒ½ã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

Font Awesome - fire

ã™ã‚‹ã¨ä¸‹è¨˜ã®ç”»åƒã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

image

æ¬¡ã«ä¸Šè¨˜ã®ç”»åƒã®çŸ¢å°ã§ç¤ºã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚

<i class="fas fa-fire"></i>
ã“ã®ã‚³ãƒ¼ãƒ‰ãŒfireã¨ã„ã†ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ã™ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚users/show.html.erbã«è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

app/views/users/show.html.erb
<p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>

<%# ã“ã“ã«è¿½åŠ  %>
<i class="fas fa-fire"></i>
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰ã€http://localhost:3000/users/id ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

id ã¯ users ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹idã«ã—ã¦ãã ã•ã„

image

ä¸Šè¨˜ã®ç”»åƒã®ã‚ˆã†ã«é»’ã„å°ã•ã„ç‚ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã†ã¾ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸Šã§ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚

6-4
ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
ã€Œ4-6 è¿½åŠ ã—ãŸã‚«ãƒ©ãƒ ã‚’ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ã§èª¬æ˜ã—ãŸé€šã‚Šã€Deviseã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã‚¹ãƒˆãƒ­ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ã¤ã¾ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã—ã‹ç·¨é›†ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ãªã®ã§ã€4-6 ã§å®Ÿè£…ã—ãŸã‚ˆã†ã«configure_permitted_parametersãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ç·¨é›†ã§ãã‚‹ã‚«ãƒ©ãƒ ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ãã‚Œã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚app/controllers/application_controller.rb ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/controllers/application_controller.rb
class ApplicationController < ActionController::Base
  before_action :configure_permitted_parameters, if: :devise_controller?

  protected

  def configure_permitted_parameters
    devise_parameter_sanitizer.permit(:sign_up, keys: [:name, :gender])

    # ã“ã®è¡Œã‚’è¿½åŠ 
    devise_parameter_sanitizer.permit(:account_update, keys: [:name, :self_introduction])

  end
end
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚ã¨é•ã†ç®‡æ‰€ã¯ã€ã‚­ãƒ¼ãŒaccount_updateã«ãªã£ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚ã“ã®ã‚­ãƒ¼ã«é–¢ã—ã¦ã¯ã€Deviseã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

å‚è€ƒï¼‰Devise - Strong Parameters

è¿½åŠ ã—ãŸã‚³ãƒ¼ãƒ‰ã§ã€nameã‚«ãƒ©ãƒ ã¨self_introductionã‚«ãƒ©ãƒ ã‚’ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸Šã§æœ¬ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
                                                    
7-4
CarrierWave ã¨ MiniMagick ã®å°å…¥
ã“ã®ãƒ‘ãƒ¼ãƒˆã§ã¯ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ã™ã‚‹ãŸã‚ã«ã€CarrierWave ã¨ MiniMagick ã®å°å…¥ã‚’ãŠã“ãªã„ã¾ã™ã€‚

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€CarrierWave ã¨ MiniMagick ã®å°å…¥ã‚’ãŠã“ãªã„ã¾ã™ã€‚

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
CarrierWave ã®å°å…¥
MiniMagick ã®å°å…¥
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£
ã§ã¯ã€é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. CarrierWave ã®å°å…¥
CarrierWave ã¯ã€Ruby on Rails ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç°¡å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

å‚è€ƒï¼‰CarrierWave

CarrierWave ã® Gem ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ãã‚Œã§ã¯ã€CarrierWave ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’Gemfile ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

# ä¸­ç•¥

gem 'jbuilder', '~> 2.7'
gem 'bootsnap', '>= 1.4.2', require: false

gem 'devise'

# ã“ã“ã«è¿½åŠ 
gem 'carrierwave', '~> 2.0'

group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
end

# ä¸­ç•¥
ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰gemã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«bundle installã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

console
bundle install
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
æ¬¡ã«ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
rails g uploader ProfileImage
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

app/uploaders/profile_image_uploader.rb
æ¬¡ã«ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«(Userãƒ¢ãƒ‡ãƒ«)ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚app/models/user.rbã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/models/user.rb
class User < ApplicationRecord
  # Include default devise modules. Others available are:
  # :confirmable, :lockable, :timeoutable, :trackable and :omniauthable
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :validatable
  
  validates :name, presence: true
  validates :self_introduction, length: { maximum: 500 }

  enum gender: { ç”·æ€§: 0, å¥³æ€§: 1 }

  # ã“ã“ã«è¿½åŠ 
  mount_uploader :profile_image, ProfileImageUploader

  def update_without_current_password(params, *options)

    if params[:password].blank? && params[:password_confirmation].blank?
      params.delete(:password)
      params.delete(:password_confirmation)
    end

    result = update_attributes(params, *options)
    clean_up_passwords
    result
  end
end
ProfileImageUploaderã¯å…ˆã»ã©ç”Ÿæˆã—ãŸprofile_image_uploader.rbãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ã‚¯ãƒ©ã‚¹åã«ãªã‚Šã¾ã™ã€‚

2. MiniMagick ã®å°å…¥
MiniMagick ã¯ç”»åƒåŠ å·¥ã‚’ã—ã¦ãã‚Œã‚‹gemã§ã™ã€‚MiniMagick ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ImageMagickã¨ã„ã†ç”»åƒå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å‚è€ƒï¼‰MiniMagick

ãªã®ã§ã€ã¾ãšãŠä½¿ã„ã®PCã«ImageMagickãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
convert -version
ä»¥ä¸‹ã®ã‚ˆã†ã«Version: ImagiMagick ~ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ãŠä½¿ã„ã®PCã«ã¯ImageMagickã¯å…¥ã£ã¦ã„ã‚‹ã®ã§ã€ãã®ã¾ã¾ MiniMagick ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«é€²ã‚“ã§ãã ã•ã„ã€‚

console
convert -version
Version: ImageMagick 7.0.10-35 Q16 x86_64 2020-11-01 https://imagemagick.org
Copyright: Â© 1999-2020 ImageMagick Studio LLC
License: https://imagemagick.org/script/license.php
Features: Cipher DPC HDRI Modules OpenMP(4.5) 
Delegates (built-in): bzlib freetype gslib heic jng jp2 jpeg lcms lqr ltdl lzma openexr png ps tiff webp xml zlib
ä¸Šè¨˜ã®ã‚ˆã†ã« Version ãŒè¡¨ç¤ºã•ã‚Œãªã‘ã‚Œã°ã€ImageMagick ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
brew install imagemagick
MiniMagick ã®Gemã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«MiniMagick ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’Gemfileã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

# ä¸­ç•¥

gem 'bootsnap', '>= 1.4.2', require: false

gem 'devise'
gem 'carrierwave', '~> 2.0'

# ã“ã“ã«è¿½åŠ 
gem "mini_magick"

group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
end

# ä¸­ç•¥
ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰gemã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«bundle installã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

console
bundle install
3. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£
æ¬¡ã«app/uploaders/profile_image_uploader.rbã‚’ä¿®æ­£ã—ã¾ã™ã€‚

ä¿®æ­£ã™ã‚‹ã®ã¯ã€ä»¥ä¸‹ã®2ç‚¹ã§ã™ã€‚

4è¡Œç›®ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™
extension_whitelist ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™
app/uploaders/profile_image_uploader.rb
class ProfileImageUploader < CarrierWave::Uploader::Base
  # Include RMagick or MiniMagick support:
  # include CarrierWave::RMagick
  include CarrierWave::MiniMagick # ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™

  # Choose what kind of storage to use for this uploader:
  storage :file
  # storage :fog

  # Override the directory where uploaded files will be stored.
  # This is a sensible default for uploaders that are meant to be mounted:
  def store_dir
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
  end

  # Provide a default URL as a default if there hasn't been a file uploaded:
  # def default_url(*args)
  #   # For Rails 3.1+ asset pipeline compatibility:
  #   # ActionController::Base.helpers.asset_path("fallback/" + [version_name, "default.png"].compact.join('_'))
  #
  #   "/images/fallback/" + [version_name, "default.png"].compact.join('_')
  # end

  # Process files as they are uploaded:
  # process scale: [200, 300]
  #
  # def scale(width, height)
  #   # do something
  # end

  # Create different versions of your uploaded files:
  # version :thumb do
  #   process resize_to_fit: [50, 50]
  # end

  # Add a white list of extensions which are allowed to be uploaded.
  # For images you might use something like this:

  # ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™
  def extension_whitelist
    %w(jpg jpeg gif png)
  end

  # Override the filename of the uploaded files:
  # Avoid using model.id or version_name here, see uploader/store.rb for details.
  # def filename
  #   "something.jpg" if original_filename
  # end
end
rb
include CarrierWave::MiniMagick
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€MiniMagickã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

rb
def extension_whitelist
  %w(jpg jpeg gif png)
end
ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ‹¡å¼µå­ã‚’åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸Šã§ã€æœ¬ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
  
8-8
Hammer.js ã®å°å…¥
ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã§ã¯Hammer.jsã‚’å°å…¥ã—ã¦ã„ãã¾ã™ã€‚

Hammer.js ã¯JavaScriptã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’å®Ÿè£…ã—ãŸã„ã¨ãã«åˆ©ç”¨ã—ãŸã„ã¨ãã«ä½¿ç”¨ã—ã¾ã™ã€‚

å‚è€ƒ: Hummer.js

æœ¬æ•™æã§ã¯ã€Hammer.jsã‚’ä½¿ã£ã¦ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€Hammer.jsã‚’å°å…¥ã—ã¾ã™ã€‚

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
Hammer.js ã®å°å…¥
application.js ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
ãã‚Œã§ã¯ã€Hammer.jsã®å°å…¥ã‚’ãŠã“ãªã„ã¾ã—ã‚‡ã†ã€‚

1. Hammer.js ã®å°å…¥
Bootstrap ã‚„ Font Awesome ã¨åŒæ§˜yarnã‚’ä½¿ã£ã¦å°å…¥ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

console
yarn add hammerjs
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

console
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
warning " > webpack-dev-server@3.11.0" has unmet peer dependency "webpack@^4.0.0 || ^5.0.0".
warning "webpack-dev-server > webpack-dev-middleware@3.7.2" has unmet peer dependency "webpack@^4.0.0".
[4/4] ğŸ”¨  Building fresh packages...
success Saved lockfile.
success Saved 1 new dependency.
info Direct dependencies
â””â”€ hammerjs@2.0.8
info All dependencies
â””â”€ hammerjs@2.0.8
âœ¨  Done in 2.72s.
package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

package.json
    "@rails/ujs": "^6.0.0",
    "@rails/webpacker": "4.3.0",
    "bootstrap": "^4.5.3",
+   "hammerjs": "^2.0.8",
    "jquery": "^3.5.1",
    "popper.js": "^1.16.1",
    "turbolinks": "^5.2.0"
2. application.js ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
yarnã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸHammer.jsã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«importã—ã¾ã™ã€‚

app/javascript/packs/application.js ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/javascript/packs/application.js
import 'bootstrap';

// ã“ã“ã«è¿½åŠ 
import 'hammerjs';

import '../stylesheets/application';
import '@fortawesome/fontawesome-free/js/all';

// ä¸­ç•¥
ä»¥ä¸Šã§ä»Šå›ã®ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
  
12-6
Action Cable ã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£…
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ãŸã‚ã« Action Cable ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚’ãŠã“ãªã„ã¾ã™ã€‚

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒ å†…ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—Enterã‚’æŠ¼ã™ã¨ã€å…¥åŠ›ã—ãŸå†…å®¹ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆã§è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã™ã€‚

image

ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
Action Cable ã¨ã¯
ChatRoomãƒãƒ£ãƒãƒ«ã®ä½œæˆ
chat_room_channel.rb ã®å®Ÿè£…
chat_room_channel.js ã®å®Ÿè£…
ã§ã¯é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. Action Cable ã¨ã¯
Action Cable ã¨ã¯ã€WebSocketã¨Railsã®ãã®ä»–ã®éƒ¨åˆ†ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«çµ±åˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚Action Cable ãŒ Rails5 ã‹ã‚‰å°å…¥ã•ã‚ŒãŸã“ã¨ã§ã€Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŠ¹ç‡ã®è‰¯ã•ã¨ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’æãªã‚ãšã«ã€é€šå¸¸ã® Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»æ–¹æ³•ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚’Rubyã§è¨˜è¿°ã§ãã¾ã™ã€‚

å‚è€ƒ: Action Cable ã®æ¦‚è¦

WebSocket ã¨ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚µãƒ¼ãƒãƒ¼é–“ã‚’å¸¸æ™‚æ¥ç¶šçŠ¶æ…‹ã«ã—ã¦åŒæ–¹å‘é€šä¿¡ãŒã§ãã‚‹æŠ€è¡“ã§ã™ã€‚

å‚è€ƒ: WebSocket

2. ChatRoomãƒãƒ£ãƒãƒ«ã®ä½œæˆ
ãã‚Œã§ã¯ã€Action Cableã®è¨­å®šã‚’ãŠã“ãªã£ã¦ã„ãã¾ã™ã€‚

Action Cable ã§ã¯ã€ãƒãƒ£ãƒãƒ«(Channel) ã¨ã„ã†ã‚‚ã®ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒãƒ£ãƒãƒ«ã«ã¯è«–ç†çš„ãªå‡¦ç†ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚MVCã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæœãŸã™å½¹å‰²ã¨ä¼¼ã¦ã„ã¾ã™ã€‚

ãã‚Œã§ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ChatRoomãƒãƒ£ãƒãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

console
rails g channel chat_room speak
å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

console
rails g channel chat_room speak
Running via Spring preloader in process 28144
      invoke  test_unit
      create    test/channels/chat_room_channel_test.rb
      create  app/channels/chat_room_channel.rb
   identical  app/javascript/channels/index.js
   identical  app/javascript/channels/consumer.js
      create  app/javascript/channels/chat_room_channel.js
ä½œæˆã•ã‚ŒãŸã€chat_room_channel.rbã¨chat_room_channel.jsã®ä¸­èº«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

app/channels/chat_room_channel.rb
class ChatRoomChannel < ApplicationCable::Channel
  def subscribed
    # stream_from "some_channel"
  end

  def unsubscribed
    # Any cleanup needed when channel is unsubscribed
  end

  def speak
  end
end
app/javascript/channels/chat_room_channel.js
import consumer from "./consumer"

consumer.subscriptions.create("ChatRoomChannel", {
  connected() {
    // Called when the subscription is ready for use on the server
  },

  disconnected() {
    // Called when the subscription has been terminated by the server
  },

  received(data) {
    // Called when there's incoming data on the websocket for this channel
  },

  speak: function() {
    return this.perform('speak');
  }
});
3. chat_room_channel.rb ã®å®Ÿè£…
æ¬¡ã«ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚’ã™ã‚‹app/channels/chat_room_channel.rbã®å®Ÿè£…ã‚’ã—ã¾ã™ã€‚

app/channels/chat_room_channel.rb ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/channels/chat_room_channel.rb
class ChatRoomChannel < ApplicationCable::Channel
  def subscribed
    # ã“ã®è¡Œã‚’ç·¨é›†ã™ã‚‹
    stream_from "chat_room_channel"
  end

  def unsubscribed
    # Any cleanup needed when channel is unsubscribed
  end

  # ==========ã“ã“ã‹ã‚‰ç·¨é›†ã™ã‚‹==========
  def speak(data)
    ActionCable.server.broadcast 'chat_room_channel', chat_message: data['chat_message']
  end
  # ==========ã“ã“ã¾ã§ç·¨é›†ã™ã‚‹==========
end
rb
def subscribed
  stream_from "chat_room_channel"
end
subscribedã§ã©ã®channel(ä»Šå›ã¯chat_room_channel)ã‚’è³¼èª­ã™ã‚‹ã‹æŒ‡å®šã—ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã€chat_room_channel.rbã¨chat_room_channel.jsã§ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ã§ãã¾ã™ã€‚

rb
def speak(data)
  ActionCable.server.broadcast 'chat_room_channel', chat_message: data['chat_message']
end
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€chat_room_channel.jsã§å®Ÿè¡Œã•ã‚ŒãŸspeakã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®chat_messageã‚’å—ã‘å–ã‚Šã€chat_room_channel.jsã®receivedãƒ¡ã‚½ãƒƒãƒ‰ã«dataã‚’é€ä¿¡ã—ã¾ã™ã€‚

4. chat_room_channel.js ã®å®Ÿè£…
æ¬¡ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚’ã™ã‚‹app/javascripts/channels/room_channel.jsã‚’å®Ÿè£…ã—ã¾ã™ã€‚

æœ€åˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã«æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ã‚¨ãƒ³ã‚¿ãƒ¼ã‚’æŠ¼ã—ãŸã‚‰ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã™ã€‚

app/javascripts/channels/room_channel.js
import consumer from "./consumer"

// ã“ã®è¡Œã‚’ç·¨é›†ã™ã‚‹
const appChatRoom = consumer.subscriptions.create("ChatRoomChannel", {
  connected() {
    // Called when the subscription is ready for use on the server
  },

  disconnected() {
    // Called when the subscription has been terminated by the server
  },

  received(data) {
    // ã“ã®è¡Œã‚’ç·¨é›†ã™ã‚‹
    return alert(data['chat_message']);
  },

  // ==========ã“ã“ã‹ã‚‰ç·¨é›†ã™ã‚‹==========
  speak: function(chat_message) {
    return this.perform('speak', { chat_message: chat_message });
  }
  // ==========ã“ã“ã¾ã§ç·¨é›†ã™ã‚‹==========
});

// ==========ã“ã“ã‹ã‚‰è¿½åŠ ã™ã‚‹==========
if(/chat_rooms/.test(location.pathname)) {
  $(document).on("keydown", ".chat-room__message-form_textarea", function(e) {
    if (e.key === "Enter") {
      appChatRoom.speak(e.target.value);
      e.target.value = '';
      e.preventDefault();
    }
  })
}
// ==========ã“ã“ã¾ã§è¿½åŠ ã™ã‚‹==========
js
if(/chat_rooms/.test(location.pathname)) {
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’ç¢ºã‹ã‚ã¦ã„ã¾ã™ã€‚ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã ã‘ã§ä¸Šè¨˜ã®å‡¦ç†ã‚’ã—ãŸã„ãŸã‚ã§ã™ã€‚

location.pathname ã§ç¾åœ¨ã®ãƒšãƒ¼ã‚¸URLã®ãƒ‘ã‚¹ã‚’å‚ç…§ã—ã¾ã™ã€‚http://localhost:3000/chat_rooms/1 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰ã€/chat_rooms/1ã‚’å–å¾—ã—ã¾ã™ã€‚

.test()ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€æ­£è¦è¡¨ç¾ã§æŒ‡å®šã•ã‚ŒãŸæ–‡å­—åˆ—ã®ä¸€è‡´ã‚’èª¿ã¹ã‚‹ãŸã‚ã®æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚æ­£ã§ã‚ã‚Œã°trueã‚’è¿”ã—ã¾ã™ã€‚

å‚è€ƒ: MDN web docs - RegExp.prototype.test()

js
$(document).on("keydown", ".chat-room__message-form_textarea", function(e) {
  if (e.key === "Enter") {
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€ãƒ•ã‚©ãƒ¼ãƒ å†…ã§Enterã‚­ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã«å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

js
appChatRoom.speak(e.target.value);
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€speakã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºç«ã•ã›ã¦ã„ã¾ã™ã€‚

js
speak: function(chat_message) {
  return this.perform('speak', { chat_message: chat_message });
}
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€chat_room_channel.rbã®speakã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«chat_messageã‚’é€ã£ã¦ã„ã¾ã™ã€‚

js
received(data) {
  return alert(data['chat_message']);
},
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€chat_room_channel.rbã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸdataã‚’å—ã‘å–ã‚Šã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

ãã‚Œã§ã¯ã€å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã€Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚

image

ä¸Šè¨˜ã®å‹•ç”»ã®ã‚ˆã†ã«å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãŒã‚¢ãƒ©ãƒ¼ãƒˆã«è¡¨ç¤ºã•ã‚Œã‚Œã°ã†ã¾ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºã¾ã§ã®æµã‚Œ
ã“ã“ã¾ã§ã®ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºã¾ã§ã®æµã‚Œã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒ å†…ã§Enterã‚­ãƒ¼ã‚’æŠ¼ã™
chat_room_channel.js ã® appChatRoom ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç«
å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆ(chat_message)ã‚’ chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚‹
chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€é€ã‚‰ã‚ŒãŸchat_messageã‚’å—ã‘å–ã‚Šã€chat_room_channel.js ã® received ã« data ã‚’é€ã‚‹
ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ãŸreceivedã§ã¯ã€å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆã§è¡¨ç¤º
ä»¥ä¸Šã§æœ¬ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

æ¬¡ã®ãƒ‘ãƒ¼ãƒˆã§ã‚‚å¼•ãç¶šã Action Cable ã®å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
  
12-7
Action Cable ã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£… 2
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€å¼•ãç¶šã Action Cable ã‚’ä½¿ã£ãŸãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

æœ¬ãƒ‘ãƒ¼ãƒˆã®ã‚´ãƒ¼ãƒ«
æœ¬ãƒ‘ãƒ¼ãƒˆã§ã¯ã€å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’chat_messagesãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã—ã€ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã™ã€‚


ã‚´ãƒ¼ãƒ«ã¾ã§ã®æµã‚Œ
chat_room_id ã‚’ chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚‹
é€ã‚‰ã‚Œã¦ããŸãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹
ä¿å­˜å¾Œã®å‡¦ç†ã‚’è¿½åŠ 
ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å‡¦ç†ã®è¿½åŠ 
ãƒ–ãƒ©ã‚¦ã‚¶å†…ã®è¡¨ç¤ºã‚’æ›¸ãæ›ãˆã‚‹
ã§ã¯é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. chat_room_id ã‚’ chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚‹
ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ã«ã¯ã€ã©ã®ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§è¡Œãªã‚ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãªã®ã‹chat_room_idãŒå¿…è¦ã§ã™ã€‚

ãªã®ã§ã€chat_room_idã‚’chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

app/javascripts/channels/chat_room_channel.js ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/javascripts/channels/chat_room_channel.js
  // ä¸­ç•¥

  // ==========ã“ã“ã‹ã‚‰ç·¨é›†==========
  speak: function(chat_message, chat_room_id) {
    return this.perform('speak', { chat_message: chat_message, chat_room_id: chat_room_id });
  }
  // ==========ã“ã“ã¾ã§ç·¨é›†==========
});

if(/chat_rooms/.test(location.pathname)) {
  $(document).on("keydown", ".chat-room__message-form_textarea", function(e) {
    if (e.key === "Enter") {
      // ã“ã®è¡Œã‚’è¿½åŠ 
      const chat_room_id = $('textarea').data('chat_room_id')
      // ã“ã®è¡Œã‚’ç·¨é›†
      appChatRoom.speak(e.target.value, chat_room_id);
      e.target.value = '';
      e.preventDefault();
    }
  })
}
js
const chat_room_id = $('textarea').data('chat_room_id')
appChatRoom.speak(e.target.value, chat_room_id);
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§chat_room_idã‚’å–å¾—ã—ã€appChatRoomã®speakã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«chat_room_idã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¦ã„ã¾ã™ã€‚

js
speak: function(chat_message, chat_room_id) {
    return this.perform('speak', { chat_message: chat_message, chat_room_id: chat_room_id });
  }
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€chat_room_idã‚’chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã£ã¦ã„ã¾ã™ã€‚

2. é€ã‚‰ã‚Œã¦ããŸãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹
æ¬¡ã«ã€chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§é€ã‚‰ã‚Œã¦ããŸãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’chat_messagesãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

app/channels/chat_room_channel.rb ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/channels/chat_room_channel.rb
  # çœç•¥

  def unsubscribed
    # Any cleanup needed when channel is unsubscribed
  end

  def speak(data)
    # ==========ã“ã“ã‹ã‚‰ç·¨é›†ã™ã‚‹==========
    ChatMessage.create!(
      content: data['chat_message'],
      user_id: current_user.id,
      chat_room_id: data['chat_room_id']
    )
    # ==========ã“ã“ã¾ã§ç·¨é›†ã™ã‚‹==========
  end
end
contentåŠã³chat_room_idã¯ã€chat_room_channel.jsã®speakã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™ã€‚

ã¾ãŸèª°ãŒãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ãŸã‹ã®user_idãŒå¿…è¦ãªãŸã‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼(current_user)ã®idã‚’ä¿å­˜ã—ã¾ã™ã€‚

chat_room_channel.rb ã§ current_user ã‚’å–å¾—
å…ˆã»ã©ã€current_userã‚’ä½¿ã„ã¾ã—ãŸãŒã€chat_room_channel.rb ã§ã¯current_userã‚’ä½¿ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€app/channels/application_cable/connection.rbã§current_userã‚’ä½¿ã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

app/channels/application_cable/connection.rbã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/channels/application_cable/connection.rb
module ApplicationCable
  class Connection < ActionCable::Connection::Base
    identified_by :current_user

    def connect
      reject_unauthorized_connection unless find_verified_user
    end

    private

      def find_verified_user
        self.current_user = env['warden'].user
      end
  end
end
identified_byã¯ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼é–“ã®é–¢ä¿‚ã‚’æˆç«‹ã•ã›ã‚‹åŸºç¤)ã‚’è­˜åˆ¥ã™ã‚‹ã‚­ãƒ¼ã§ã™ã€‚

rb
env['warden'].user
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚

rb
reject_unauthorized_connection
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯ã€WebSocketæ¥ç¶šãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã€404ã‚’è¿”ã—ã¾ã™ã€‚

å‚è€ƒ: ActionCable :: Connection :: Authorization

3. ä¿å­˜å¾Œã®å‡¦ç†ã‚’è¿½åŠ 
æ¬¡ã«chat_messagesãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ãŸå¾Œã®å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ãŸå¾Œã«å‡¦ç†ã‚’æ›¸ããŸã„å ´åˆã€ãƒ¢ãƒ‡ãƒ«ã«after_create_commitç­‰ã‚’ä½¿ã„ã¾ã™ã€‚

å‚è€ƒ: Active Record ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ - 10 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

ãã‚Œã§ã¯ã€app/models/chat_message.rbã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

app/models/chat_message.rb
class ChatMessage < ApplicationRecord
  belongs_to :user
  belongs_to :chat_room

  # ã“ã®è¡Œã‚’è¿½åŠ 
  after_create_commit { ChatMessageBroadcastJob.perform_later self }
end
rb
after_create_commit { ChatMessageBroadcastJob.perform_later self }
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜å¾Œã«ChatMeesageBroadcastJobã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

4. ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å‡¦ç†ã®è¿½åŠ 
å…ˆã»ã©ã€speakãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å‡¦ç†ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

å…ˆã»ã©å‰Šé™¤ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã§ã™ã€‚

app/channels/chat_room_channel.rb
ActionCable.server.broadcast 'chat_room_channel', chat_message: data['chat_message']
ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’ã™ã‚‹ã“ã¨ã§ã€ä»–ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãã‚Œã§ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ChatMessageBroadcastJobã‚’ä½œæˆã—ã¾ã™ã€‚

console
rails g job ChatMessageBroadcastJob
å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

console
rails g job ChatMessageBroadcastJob
Running via Spring preloader in process 38489
      invoke  test_unit
      create    test/jobs/chat_message_broadcast_job_test.rb
      create  app/jobs/chat_message_broadcast_job.rb
ä½œæˆã—ãŸã€app/jobs/chat_message_broadcast_job.rb ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/jobs/chat_message_broadcast_job.rb
class ChatMessageBroadcastJob < ApplicationJob
  queue_as :default

  def perform(chat_message)
    ActionCable.server.broadcast 'chat_room_channel', chat_message: render_chat_message(chat_message)
  end

  private

    def render_chat_message(chat_message)
      ApplicationController.renderer.render(partial: 'chat_messages/chat_message', locals: { chat_message: chat_message, current_user: chat_message.user })
    end
end
rb
def perform(chat_message)
  ActionCable.server.broadcast 'chat_room_channel', chat_message: render_chat_message(chat_message)
end
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€render_chat_message(chat_message)ã§render_chat_messageãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

rb
def render_chat_message(chat_message)
  ApplicationController.renderer.render(partial: 'chat_messages/chat_message', locals: { chat_message: chat_message, current_user: chat_message.user })
end
ApplicationController.rendererã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®åˆ¶ç´„ã‚’å—ã‘ãšã«ã€ä»»æ„ã®ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ä»Šå›ã¯ã€chat_messages/_chat_message.html.erbã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

localsã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€éƒ¨åˆ†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ãˆã‚‹å¤‰æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

5. ãƒ–ãƒ©ã‚¦ã‚¶å†…ã®è¡¨ç¤ºã‚’æ›¸ãæ›ãˆã‚‹
æœ€å¾Œã«ã€chat_room_channel.jsã®receivedã‚’æ›¸ãæ›ãˆã¦ã€ã‚¢ãƒ©ãƒ¼ãƒˆã§ã¯ãªããƒ–ãƒ©ã‚¦ã‚¶å†…ã®è¡¨ç¤ºã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

chat_room_channel.jsã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ãã ã•ã„ã€‚

app/javascripts/channels/room_channel.js
  // ä¸­ç•¥

  disconnected() {
    // Called when the subscription has been terminated by the server
  },

  received(data) {
    // =========ã“ã“ã‹ã‚‰ç·¨é›†==========
    const chatMessages = document.getElementById('chat-messages');
    chatMessages.insertAdjacentHTML('beforeend', data['chat_message']);
    // =========ã“ã“ã¾ã§ç·¨é›†==========
  },

  speak: function(chat_message, chat_room_id) {
    return this.perform('speak', { chat_message: chat_message, chat_room_id: chat_room_id });
  }
});

// ä¸­ç•¥
document.getElementById('chat-messages');ã§id="chat-messages"ã®è¦ç´ ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚

å‚è€ƒ: MDN web docs - Document.getElementById()

id="chat-messages"ã®è¦ç´ ã¯ã€app/views/chat_rooms/show.html.erbã«ã‚ã‚Šã¾ã™ã€‚

app/views/chat_rooms/show.html.erb
<div id='chat-messages'>
  <%= render @chat_messages %>
</div>
js
chatMessages.insertAdjacentHTML('beforeend', data['chat_message']);
insertAdjacentHTML ã§ç¬¬2å¼•æ•°ã®data['chat_message']ã‚’æŒ¿å…¥ã—ã¾ã™ã€‚æŒ¿å…¥ä½ç½®ã¯ã€'beforeend'ãªã®ã§ã€element å†…éƒ¨ã®ã€æœ€å¾Œã®å­è¦ç´ ã®å¾Œã«æŒ¿å…¥ã—ã¾ã™ã€‚

å‚è€ƒ: MDN web docs - element.insertAdjacentHTML

ä»¥ä¸Šã§ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®å®Ÿè£…ã¯å®Œäº†ã§ã™ã€‚ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã§å‹•ä½œç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ã€‚


ä¸Šè¨˜ã®ã‚ˆã†ã«å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãŒãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã‚Œã°ã†ã¾ãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã™ã‚‹ã¾ã§ã®æµã‚Œ
ã“ã“ã¾ã§ã®ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã¾ã§ã®æµã‚Œã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒ å†…ã§Enterã‚’æŠ¼ã™
chat_room_channel.js ã® appChatRoom ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç«
å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆ(chat_message)ã‚’ chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã‚‹
chat_room_channel.rb ã® speak ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€é€ã‚‰ã‚ŒãŸchat_messageã‚’å—ã‘å–ã‚Šã€chat_messages ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã€‚ChatMeesageBroadcastJobã‚’å‘¼ã¶ã€‚
chat_message_broadcast_job.rb ã§éƒ¨åˆ†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆchat_messages/_chat_message.html.erbã‚’å‘¼ã³å‡ºã™ã€‚
chat_room_channel.jsã®receivedã‚’å‘¼ã³å‡ºã—ã€ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
ä»¥ä¸Šã§æœ¬ãƒ‘ãƒ¼ãƒˆã¯çµ‚äº†ã§ã™ã€‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚
         
